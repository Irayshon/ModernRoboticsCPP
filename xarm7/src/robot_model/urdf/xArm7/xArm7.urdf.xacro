<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:macro name="xarm7_urdf" params="prefix
    joint1_lower_limit:=${-2.0*pi}  joint1_upper_limit:=${2.0*pi}
    joint2_lower_limit:=${-2.059}  joint2_upper_limit:=${2.0944}
    joint3_lower_limit:=${-2.0*pi}  joint3_upper_limit:=${2.0*pi}
    joint4_lower_limit:=${-0.19198}  joint4_upper_limit:=${3.927}
    joint5_lower_limit:=${-2.0*pi}  joint5_upper_limit:=${2.0*pi}
    joint6_lower_limit:=${-1.69297}  joint6_upper_limit:=${pi}
    joint7_lower_limit:=${-2.0*pi}  joint7_upper_limit:=${2.0*pi}
    model_num:=0
  inertial_params_filename:='' kinematics_params_filename:=''
  mesh_path:='package://robot_model/meshes' "
    >


    <!-- remember to see old code -->
  <xacro:property name="visual_dir" value="${mesh_path}/xArm7/visual"/>
  <xacro:property name="collision_dir" value="${mesh_path}/xArm7/collision"/>
  <xacro:property name="link7_visual" value="${mesh_path}/xArm7/visual/link7.stl"/>
  <xacro:property name="link7_collision" value="${mesh_path}/xArm7/collision/link7.obj"/>


    <!-- load params and define property -->
    <xacro:property name="default_inertial_params_filename" value="xarm7_type7_HT_BR2"/>
    <xacro:property name="link_inertial_params_file" value="$(find robot_model)/config/link_inertial/${default_inertial_params_filename}.yaml"/>


    <!-- see old code if issuess -->
    <xacro:property name="inertial_params" value="${xacro.load_yaml(link_inertial_params_file)}"/>
    <xacro:property name="kinematics_config" value="${xacro.load_yaml(kinematics_params_filename)}"/>
    <xacro:property name="kinematics_params" value="${kinematics_config['kinematics']}"/>

    <!-- Base Link -->
    <link name="${prefix}link_base">
      <inertial>
        <origin xyz="-0.021131 -0.0016302 0.056488" rpy="0 0 0" />
        <mass value="0.88556" />
        <inertia
          ixx="0.0030595" ixy="0.00012259" ixz="-0.00062705"
          iyy="0.0037783" iyz="0.00027023" izz="0.0020125" />
      </inertial>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link_base.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link_base.obj"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>

    <!-- Link 1 -->
    <link name="${prefix}link1">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link1']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link1.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link1.obj"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>
    <!-- Link 1 Joint -->
    <joint name="${prefix}joint1" type="revolute">
      <!-- <origin xyz="0 0 0.267" rpy="0 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint1']}" />
      <parent link="${prefix}link_base" />
      <child link="${prefix}link1" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint1_lower_limit}"
        upper="${joint1_upper_limit}"
        effort="50"
        velocity="3.14" />
      <dynamics damping="10" friction="1" />
    </joint>

    <!-- Link 2 -->
    <link name="${prefix}link2">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link2']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link2.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link2.obj"
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>
    <!-- Link 2 Joint -->
    <joint name="${prefix}joint2" type="revolute">
      <!-- <origin xyz="0 0 0" rpy="-1.5708 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint2']}" />
      <parent link="${prefix}link1" />
      <child link="${prefix}link2" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint2_lower_limit}"
        upper="${joint2_upper_limit}"
        effort="50"
        velocity="3.14" />
      <dynamics damping="10" friction="1" />
    </joint>

    <!-- Link 3 -->
    <link name="${prefix}link3">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link3']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link3.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link3.obj"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>
    <!-- Link 3 Joint -->
    <joint name="${prefix}joint3" type="revolute">
      <!-- <origin xyz="0 -0.293 0" rpy="1.5708 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint3']}" />
      <parent link="${prefix}link2" />
      <child link="${prefix}link3" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint3_lower_limit}"
        upper="${joint3_upper_limit}"
        effort="30"
        velocity="3.14" />
      <dynamics damping="5" friction="1" />
    </joint>

    <!-- Link 4 -->
    <link name="${prefix}link4">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link4']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link4.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link4.obj"
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>

    <!-- Link 4 joint -->
    <joint name="${prefix}joint4" type="revolute">
      <!-- <origin xyz="0.0525 0 0" rpy="1.5708 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint4']}" />
      <parent link="${prefix}link3" />
      <child link="${prefix}link4" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint4_lower_limit}"
        upper="${joint4_upper_limit}"
        effort="30"
        velocity="3.14" />
      <dynamics damping="5" friction="1" />
    </joint>

    <!-- Link 5 -->
    <link name="${prefix}link5">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link5']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link5.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link5.obj" 
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>
    <!-- Link 5 joint -->
    <joint name="${prefix}joint5" type="revolute">
      <!-- <origin xyz="0.0775 -0.3425 0" rpy="1.5708 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint5']}" />
      <parent link="${prefix}link4" />
      <child link="${prefix}link5" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint5_lower_limit}"
        upper="${joint5_upper_limit}"
        effort="30"
        velocity="3.14" />
      <dynamics damping="5" friction="1" />
    </joint>

    <!-- Link 6 -->
    <link name="${prefix}link6">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link6']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${visual_dir}/link6.stl"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="White" />
      <xacro:common_link_collision 
        mesh_filename="${collision_dir}/link6.obj"
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>
    <!-- Link 6 joint -->
    <joint name="${prefix}joint6" type="revolute">
      <!-- <origin xyz="0 0 0" rpy="1.5708 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint6']}" />
      <parent link="${prefix}link5" />
      <child link="${prefix}link6" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint6_lower_limit}"
        upper="${joint6_upper_limit}"
        effort="20"
        velocity="3.14" />
      <dynamics damping="2" friction="1" />
    </joint>
    
    <!-- Link 7 -->
    <link name="${prefix}link7">
      <xacro:common_link_inertial 
        link_inertial_params="${inertial_params['link7']}" 
        origin_rpy="0 0 0"/>
      <xacro:common_link_visual 
        mesh_filename="${link7_visual}"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0"
        material_name="Silver" />
      <xacro:common_link_collision 
        mesh_filename="${link7_collision}"  
        origin_xyz="0 0 0" 
        origin_rpy="0 0 0" />
    </link>
    <!-- Link 7 Joint where EEf added -->
    <joint name="${prefix}joint7" type="revolute">
      <!-- <origin xyz="0.076 0.097 0" rpy="-1.5708 0 0" /> -->
      <xacro:common_joint_origin joint_kinematic_params="${kinematics_params['joint7']}" />
      <parent link="${prefix}link6" />
      <child link="${prefix}link7" />
      <axis xyz="0 0 1" />
      <limit
        lower="${joint7_lower_limit}"
        upper="${joint7_upper_limit}"
        effort="20"
        velocity="3.14" />
      <dynamics damping="2" friction="1" />
    </joint>

    <link name="${prefix}link_eef" />
    <joint name="${prefix}joint_eef" type="fixed">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <parent link="${prefix}link7" />
      <child link="${prefix}link_eef" />
    </joint>
  
  </xacro:macro>
</robot>